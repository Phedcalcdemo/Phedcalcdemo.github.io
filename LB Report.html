<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DTR Load Balancing Report</title>
</head>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<style>
body {
/*    background:rgba(143,65,67,1.00);*/
}
#errorMessage {
	/*	display: flex;*/
	position: relative;
	bottom: 0px;
	margin-top: 50px;
	color: red;
	font-size: 18px;/*  margin-top: 10px*/
	width: 350px;
	height: 60px;
	/*	background-color: burlywood;*/
	word-wrap: break-word
}
.thumbnail {
	width: 80px;
	height: 50px;
	margin-right: 10px;
}
.uploadPreview {
	max-height: 80px;
	display: flex
}
#result {
	/*			background-color: antiquewhite;*/
	box-shadow: 2px 2px 8px rgba(0, 0, 0, .2);
	margin-top: 10px;
	margin-bottom: 10px;
	padding: 10px
}
.green-text {
	color: green
}
.blue-text {
	color: blue
}
.purple-text {
	color: rebeccapurple
}
input, select {
	/*			margin-left: 20px;*/
	margin-bottom: 5px;
	font-size: 18px
}
button {
	background-color: #008ECC;
	outline: none !important;
	border: none !important;
	box-shadow: 3px 2px 8px rgba(0, 0, 0, .2);
}
body {
	display: flex;
	justify-content: center;
	align-items: center;
	/*	height: 100vh;*/
	margin: 0;
	background-color: #534484;
}
.wrapper {
	/* Add any other styling you need for the parent container */
	max-width: 800px;
	padding: 20px;
	border: 1px solid #ccc;
	border-radius: 5px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
	background: #F0F1D5;
	padding-bottom: 50px
}
		::placeholder {
font-size: 18px
}
.select-input {
	font-size: 18px;
}
.form-container .btn-primary, .output .btn-primary .toggleButton {
	background-color: #008ECC;
	outline: none !important;
	border: none !important;
	font-size: 20px;
	padding: 0px 10px;/*	border-radius: 14px*/
}
.form-container .btn-primary:focus, .output .btn-primary:focus {
	outline: none !important;
	border: none !important
}
.form-control {
	font-size: 18px
}
.capture {
	position: relative;
	background-color: #04AA6D;
	border: none;
	/*  font-size: 28px;*/
	color: #FFFFFF;
	padding: 20px;
	width: 200px;
	text-align: center;
	-webkit-transition-duration: 0.4s; /* Safari */
	transition-duration: 0.4s;
	text-decoration: none;
	overflow: hidden;
	cursor: pointer;
}
.capture:after {
	content: "";
	background: #90EE90;
	display: block;
	position: absolute;
	padding-top: 300%;
	padding-left: 350%;
	margin-left: -20px!important;
	margin-top: -120%;
	opacity: 0;
	transition: all 0.8s
}
.capture:active:after {
	padding: 0;
	margin: 0;
	opacity: 1;
	transition: 0s
}
</style>

<body style="text-align: center">
<div class="wrapper">
  <div style="margin-top: 10px; text-align: center;"> <img class="phed"  src="PHED logo.png" width="150px" height="auto" alt="PHED">
    <h3>DTR LOAD BALANCING REPORT</h3>
  </div>
  <div id="result" style="font-size: 16px; color:black; background-color: white"></div>
  <form class="form-container" required>
    <div class="info">
		
      <h3>Additional Information</h3>
    </div>
    <select id="selectRegion" class="form-control input select-input drop-down-caret" style="margin-top: 10px">
      <option value="" disabled selected>Select Region *</option>
      <option>Alpha 1</option>
      <option>Alpha 2</option>
      <option>Beta 1</option>
      <option>Beta 2</option>
      <option>Gamma 1</option>
      <option>Gamma 2</option>
      <option>Calabar</option>
      <option>Ogoja</option>
      <option>Bayelsa</option>
      <option>Ahoada</option>
      <option>Uyo</option>
      <option>Eket</option>
      <option>Ikot Ekpene</option>
    </select>
	    <select id="vL" class="form-control input select-input drop-down-caret">
      <option value="" disabled selected>Voltage Level *</option>
      <option>11KV</option>
      <option>33KV</option>
    </select>
	  
    <select id="selectFeeder" class="form-control input select-input drop-down-caret">
      <option value="" disabled Selected>Select Feeder *</option>
      <!-- Placeholder option for "Select Feeder" -->
    </select>
  
    
    <!-- Additional input fields --> 
    <!--  <input type="text" id="feederName" class="form-control load" placeholder="Feeder name *" required>-->
    <input type="text" id="dtrName" class="form-control " placeholder="DTR SS Name *" required>
    <input type="number" id="dtrId" class="form-control " placeholder="DTR-ID*" required>
    <hr>
    <div style="text-align: left; margin-bottom: 10px">
      <button type="button" class="capture pure-button pure-button-primary rounded-pill" style="color: white; font-size: 14px; padding:4px 10px">Capture GPS coordinates</button>
      <br>
      <span style="color: green; font-size: 12px">[Only use the capture button if you are at the DTR Substation]</span> <br>
      <h5 style="text-align: left; color: gray">Acceptable Format is Decimal degrees. (Lat,Long)</h5>
      <input type="text" id="gpsResult" class="form-control gpsResult" placeholder=" E.g: 7.123423,9.365221 " required>
    </div>
    <hr>
    <div style="text-align: left">
      <h4 style="color: gray; word-wrap: break-word; max-width: 400px"> Please upload photos of the clamp meter showing the neutral values captured before and after load balancing </h4>
      <input type="file" accept="image/*" id="uploadImage" name="imageFile" class="file_input" multiple="2" />
      <div id="picView" class="uploadPreview"></div>
    </div>
    <hr>
    <div > <a href="index.html" style="float: left; background-color: green; text-decoration: none; padding-left: 5px; padding-right: 5px; width: 45%" class="btn-primary button rounded-3">Back</a>
      <button type="submit" class="btn btn-primary rounded-3" formaction="#"  id="lbSubmit" style="float: right; width: 45%" >Submit</button>
    </div>
  </form>
  <div id="errorMessage"></div>
</div>
 
	
   <script>
        // Function to populate feeders based on region and voltage level
        function populateFeeders() {
            const regionSelect = document.getElementById('selectRegion');
            const voltageSelect = document.getElementById('vL');
            const feederSelect = document.getElementById('selectFeeder');

            // Define feeder options based on region and voltage
            const feeders = {
                'Alpha 1': {
                    '11KV': ['Amadi', 'Shell Industrial', 'Barracks', 'Rumuomoi', 'Water Lines', 'Bori Camp', 'Rumuokwuta', 'Omerelu', 'New Gra', 'Elekahia Estate', 'Elekahia Village', 'Niger Cat', 'Nkpogu', 'Amadi Ama', 'Rumukalagbo', 'Old Aba Road', 'Rumuogba', 'Rumuorolu', 'Rumuibekwe', 'RIVOC', 'NDABROS', 'Water Works', 'Fimie'].sort(),
					'33KV': ['Industrial(T/A)', 'Stadium(T/A)', 'Ordinance', 'Rumuola', 'Refinery Line 2', 'Rainbow', 'Akani', 'Trans Amadi'].sort()
                },
                'Alpha 2': {
                    '11KV': ['Jetty', 'Ozuboko', 'Odili Road', 'Okuru', 'Gulf Estate', 'Azuabie', 'Glass Factory', 'Circular Road', 'Nvuigwe', 'Ogbatai', 'Npa', 'Churchill', 'Station Road', 'Amadi North', 'Harold Wilson', 'New Road', 'Marine Base', 'Eastern Bypass'].sort(),
                    '33KV': ['NLNG', 'Abuloma', 'RSPUB 1', 'Secretariat', 'Borokiri'].sort()
                },
               'Beta 1': {
                    '11KV': ['Akpajo', 'Palace Road', 'Chairmanâ€™s Lodge', 'TTC', 'COT Gas', 'Okrika', 'PPMC Refinery', 'Ebubu', 'Ogali', 'Okoh Road', 'Okporo Road', 'R-D Road', 'Obi Wali', 'FGC', 'Eliogbolo', 'Omachi'].sort(),
                    '33KV': ['RSTV', 'Bori', 'Igbo Etche', 'Rumuodumaya'].sort()
                },
				
               'Beta 2': {
                    '11KV': ['Elelenwo', 'Bristol', 'Tap', 'Olu Obasanjo', 'Zenith', 'Railway', 'Afam Road', 'First Bank', 'Mbano Junction'].sort(),
                    '33KV': ['Onne', 'Ndoki', 'Komkom', 'Timber', 'Oyigbo', 'EPCL'].sort()
				 },
				
				 'Gamma 1': {
                    '11KV': ['UST', 'Ojoto', 'Rumueme', 'Wokoma', 'Eagle Island', 'Ikwerre Road', 'Nsukka',	'Udi', 'Navy',	'Habour Road', 'Azikiwe', 'Abonnema Wharf', 'Owerri Road', 'Amadi South', 'Amadi Residential', 'Mile One', 'Old Diobu', 'Ohakwe', 'Ozuoba', 'Mgbuoba', 'Location Road', 'akery Road', 'Egbelu', 'Agip Road', 'Abacha Road', 'School Of Nursing', 'Aker Road', 'Iwofe', 'Elioparanwo', 'Kala'].sort(),
                    '33KV': ['UST', 'Silverbird', 'UTC', 'T1B', 'NTA', 'Rumuepirikom', 'Rumuolumini'].sort()
				 },
//              
               'Gamma 2': {
                    '11KV': ['Aluu', 'Choba', 'Rumuekini', 'Sars Road', 'ADP', 'Market Road', 'OPM', 'Shell Estate', 'Pipe Line', 'Airport Complex', 'Igwuruta', 'Igwuruta Road', 'Elimgbu'].sort(),
                    '33KV': ['Airport', 'Refinery Line 1', 'UPTH', 'Rukpokwu', 'Greater Ph'].sort()
                },
				
				 'Calabar': {
                    '11KV': ['8Miles', 'Esukutan', 'Federal Housing', 'Industrial', 'Essien Town', 'MCC', 'Leopard', 'Essien I/Mariana', 'Cameroun', 'Unical', 'Goldie', 'Target', 'Crutech', 'Anantigha', 'Ikot Eneobong', 'Bacoco'].sort(),
                    '33KV': ['BaoYao', 'Akamkpa', 'EPZ1', 'EPZ2', 'Waterboard', 'Olam', 'Flour Mill', 'Niger Mills', 'Diamond Hills', 'State Housing', 'Amika', 'Adiabo', 'Transcorp'].sort()
                },
				
				'Ogoja': {
                    '11KV': ['Ikom Town', 'Four corner'].sort(),
                    '33KV': ['Itigidi', 'Yahe', 'Katsina Ala'].sort()
                },
				
				'Uyo': {
                    '11KV': ['Aka Road', 'Ibb Avenue', 'Indongesit Nkanga', 'Sir Udo Udoma', 'Uyo Road', 'Edebom', 'Wellington Bassey', 'Nsasak', 'Ikpa Road', 'Brooks', 'Aka Itiam', 'Ewet', 'Shelter Afrique', 'Nwaniba', 'Osong Ama'].sort(),
                    '33KV': ['Champions Breweries', 'Le Meridian', 'Fourlane', 'Ibesikpo', 'Oron Road'].sort()
                },
				
				
				'Ikot Ekpene': {
                    '11KV': ['Town Feeder', 'GRA', 'Ukana', '4point Sheraton', 'Mbak', 'Idoro Road'].sort(),
                    '33KV': ['Abak', 'Oku Iboku', 'Ikot Ekpene', 'Obot Akara', 'Afaha Ube'].sort()
                },
				
				'Eket': {
                    '11KV': ['Ikot Ibiok', 'Okon', 'Qua River', 'RCC', 'Afaha Uqua', 'Maritime', 'Mary Harney', 'Ikot Akan', 'ALSCON', 'Ibekwe', 'Port Harcourt Road', 'Ette Urban'].sort(),
                    '33KV': ['Eket', 'Etinan', 'Ekpenukpa', 'Mbo, Ibeno', 'Industrial', 'Ikot Abasi', 'Ekim'].sort()
                },
				'Bayelsa': {
                    '11KV': ['Local Government', 'NDU', 'Amasoma II', 'Ofoni', 'Sagbama', 'Polaku', 'Agbia', 'Okotiama', 'Kolobiri'].sort(),
                    '33KV': ['Imiringi', 'Agudama', 'Opolo', 'Amasoma', 'Tungbo', 'Govt House', 'Gbarain'].sort()
                },
				'Ahoada': {
                    '11KV': [''],
                    '33KV': ['Abonema', 'Buguma', 'Isiokpo', 'Ahoada', 'Emohua'].sort()
                },
				
                // Add other regions and voltage levels as needed...
            };

            // Event listener for region and voltage changes
            regionSelect.addEventListener('change', updateFeeders);
            voltageSelect.addEventListener('change', updateFeeders);

            // Initial population
            updateFeeders();

            function updateFeeders() {
                const selectedRegion = regionSelect.value;
                const selectedVoltage = voltageSelect.value;

                // Clear existing options
                feederSelect.innerHTML = '';

                if (selectedRegion && selectedVoltage) {
                    const selectedFeeders = feeders[selectedRegion][selectedVoltage];
                    selectedFeeders.forEach(feeder => {
                        const option = document.createElement('option');
                        option.value = feeder;
                        option.textContent = feeder;
                        feederSelect.appendChild(option);
                    });
                } else {
                    // Show placeholder option
                    const placeholderOption = document.createElement('option');
                    placeholderOption.value = '';
                    placeholderOption.textContent = 'Select Feeder *';
                    placeholderOption.disabled = true;
                    placeholderOption.selected = true;
                    feederSelect.appendChild(placeholderOption);
                }
            }
        }

        // Call the function to initialize
        populateFeeders();
    </script>
	
<script>
    // Retrieve values from query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const redPhase = urlParams.get("red");
    const yellowPhase = urlParams.get("yellow");
    const bluePhase = urlParams.get("blue");
    const neutralPhase = urlParams.get("neutral");
    const dtrCapacity = urlParams.get("capacity");
    const loadingValue = urlParams.get("loading")+ "%";
    const imbalanceValue = parseFloat(urlParams.get("imbalance")); // Convert to a numeric value

    // Determine the balance status based on the imbalance value
    let balanceStatus;
    if (imbalanceValue >= 1 && imbalanceValue <= 4) {
        balanceStatus = "DTR is balanced";
    } else if (imbalanceValue > 4 && imbalanceValue <= 9) {
        balanceStatus = "DTR is moderately balanced";
    } else if (imbalanceValue >= 10) {
        balanceStatus = "DTR is highly unbalanced";
//    } else {
//        balanceStatus = "Invalid imbalance value"; // Handle other cases (optional)
    }
	        
		 
		 

    // Display the extracted values in the "result" div
    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = `
			<h3 class="blue-text">DTR Loading Data</h3>
<hr>
        <p>Red Phase (A): <span class="green-text">${redPhase}</span></p>
        <p>Yellow Phase (A): <span class="green-text">${yellowPhase}</span></p>
        <p>Blue Phase (A): <span class="green-text">${bluePhase}</span></p>
        <p>Neutral Phase (A): <span class="green-text">${neutralPhase}</span></p>
        <p>DTR Capacity (KVA): <span class="green-text">${dtrCapacity}</span></p>
        <p>Percentage Loading: <span class="green-text">${loadingValue}</span></p>
        <p>Percentage Imbalance: <span class="green-text">${imbalanceValue}%</span></p>
        
        <p> <span class="purple-text">${balanceStatus}</span></p>
    `;
    </script> 
<script type="text/javascript">
  window.onload = function() {
    if (window.File && window.FileList && window.FileReader) {
      var filesInput = document.getElementById("uploadImage");
      filesInput.addEventListener("change", function(event) {
        var files = event.target.files;
        var output = document.getElementById("picView");
        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          if (!file.type.match('image')) {
            continue;
          }
          var picReader = new FileReader();
          picReader.addEventListener("load", function(event) {
            var picFile = event.target;
            var img = new Image();
            img.src = picFile.result;
            img.onload = function() {
              var canvas = document.createElement("canvas");
              var ctx = canvas.getContext("2d");
              canvas.width = 50;
              canvas.height = 50;
              ctx.drawImage(img, 0, 0, 50, 50);
              var resizedDataUrl = canvas.toDataURL("image/jpeg");
              var div = document.createElement("div");
              div.innerHTML = "<img class='thumbnail' src='" + resizedDataUrl + "'" +
                "title='" + file.name + "'/>";
              output.appendChild(div); // Append images horizontally
            };
          });
          picReader.readAsDataURL(file);
        }
      });
    }
  };
</script> 
<script>
function getLocation() {
  var msg;

  if ('geolocation' in navigator) {
    requestLocation();
  } else {
    msg = "Sorry, looks like your browser doesn't support geolocation";
    outputResult(msg);
    $('.pure-button').removeClass('pure-button-primary').addClass('pure-button-success');
  }

  function requestLocation() {
    var options = {
      enableHighAccuracy: false,
      timeout: 5000,
      maximumAge: 0
    };

    navigator.geolocation.getCurrentPosition(success, error, options);

    function success(pos) {
      var lng = pos.coords.longitude;
      var lat = pos.coords.latitude;
      msg =  lat +','+ lng;
      outputResult(msg);
      $('.pure-button').removeClass('pure-button-primary').addClass('pure-button-success');

      // Set the value of the input with ID "gpsResult"
      $('#gpsResult').val(lat+','+lng);
    }

    function error(err) {
      msg = 'Error: ' + err + ' :(';
      outputResult(msg);
      $('.pure-button').removeClass('pure-button-primary').addClass('pure-button-error');
    }
  }

  function outputResult(msg) {
    $('.gpsResult').addClass('gpsResult').html(msg);
  }
}

$('.pure-button').on('click', function() {
  $('.gpsRresult').html('<i class="fa fa-spinner fa-spin"></i>');
  getLocation();
});
</script> 
<script>
 document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector(".form-container");
    const submitButton = document.getElementById("lbSubmit");
    const errorMessage = document.getElementById("errorMessage");
    const uploadImageInput = document.getElementById("uploadImage");

    submitButton.addEventListener("click", function (event) {
        const requiredFields = form.querySelectorAll("[required]");

        for (const field of requiredFields) {
            if (!field.value.trim()) {
                event.preventDefault(); // Prevent form submission
                errorMessage.textContent = "Please fill in all required fields.";
                setTimeout(() => {
                    errorMessage.textContent = ""; // Clear the error message after 5 seconds
                }, 5000);
                return;
            }
        }

        if (!uploadImageInput.files.length) {
            event.preventDefault(); // Prevent form submission
            errorMessage.textContent = "Please upload picture evidence.";
            setTimeout(() => {
                errorMessage.textContent = ""; // Clear the error message after 5 seconds
            }, 5000);
            return;
        }

        const selectRegion = document.getElementById("selectRegion");
        if (selectRegion.value === "") {
            event.preventDefault(); // Prevent form submission
            errorMessage.textContent = "Please select a region.";
            setTimeout(() => {
                errorMessage.textContent = ""; // Clear the error message after 5 seconds
            }, 5000);
            return;
        }
		 const vL = document.getElementById("vL");
        if (vL.value === "") {
            event.preventDefault(); // Prevent form submission
            errorMessage.textContent = "Please select the Voltage level.";
            setTimeout(() => {
                errorMessage.textContent = ""; // Clear the error message after 5 seconds
            }, 5000);
            return;
        }

        const selectFeeder = document.getElementById("selectFeeder");
        if (selectFeeder.value === "") {
            event.preventDefault(); // Prevent form submission
            errorMessage.textContent = "Please select a Feeder.";
            setTimeout(() => {
                errorMessage.textContent = ""; // Clear the error message after 5 seconds
            }, 5000);
            return;
        }

       

        const urlParams = new URLSearchParams(window.location.search);
        const redPhase = parseFloat(urlParams.get("red"));

        if (isNaN(redPhase)) {
            errorMessage.textContent = "Please go back to PHED Calculator and provide the DTR loading data.";
            setTimeout(() => {
                errorMessage.textContent = ""; // Clear the error message after 5 seconds
            }, 5000);
            event.preventDefault(); // Prevent form submission
        }
    });
});


</script> 
<script>
	
	</script> 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
</body>
</html>
